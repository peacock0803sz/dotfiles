# Agent基本原則

- 作成するファイルは必ず **UTF-8** エンコーディングで保存する

## 作業分担

前提: 親エージェント(Claude)と子エージェントはMCP経由で接続している

**親エージェント (Claude)**

- 方針決定・判断・要件定義・仕様検討

**子エージェント (Codex / Gemini)**

- 詳細指示に基づく実行作業
    - 調査
    - ドキュメント作成
    - コード生成
- 優先順位
    1. カスタムサブエージェント(プロジェクト独自設定
    2. 汎用サブエージェント(Task)

## Serena MCPメモリ管理(実装作業)

### 実装前必須確認

1. `list_memories`でメモリ一覧取得
2. `read_memory`で関連メモリ確認
3. 記録されたパターン・規約を厳密に遵守

### 新規パターン記録

- 重要な実装パターン確立時は`write_memory`で記録
- 命名規則:
    - `{project}-conventions` - プロジェクト全体の規約
    - `{feature}-patterns` - 機能別実装パターン
    - `{domain}-patterns` - ドメイン固有パターン
    - `{layer}-conventions` - レイヤー固有の規約
    - `architecture-{decision}` - アーキテクチャ決定事項
    - `{service}-api-spec` - 外部サービスAPI仕様
    - `{issue}-solution` - トラブルシューティング記録
    - `refactoring-{target}` - リファクタリング方針

### メモリ管理原則

- 不要になったメモリは`delete_memory`で削除
- メモリは簡潔で検索しやすい名前を使用
- 更新頻度の高い情報は都度上書き更新

## Serena活用(コード操作)

**積極活用すべきツール**:

- `find_symbol` - シンボル検索
- `get_symbols_overview` - ファイル構造把握
- `find_referencing_symbols` - 依存関係確認
- `replace_symbol_body` - 関数/クラス全体の置換
- `insert_before_symbol` / `insert_after_symbol` - シンボル前後への挿入
- `search_for_pattern` - 横断的パターン検索

**原則**: ファイル全体読み込みより、シンボルレベル操作を優先すること

## 実装前確認事項

- **既存パターンの確認**: 実装前に必ず既存コード・ドキュメントを確認
- **ライブラリ最新情報**: ライブラリ使用時はContext7で最新仕様を確認
- **重複実装の防止**: 共通機能の独自実装前に既存コードを確認
- **メモリ確認**: `list_memories`で過去の実装パターン・決定事項を確認

## 操作制限

- **Git操作禁止**: ブランチ操作はユーザー指示時のみ
- **npm/uvなどのパッケージマネージャー操作禁止**: パッケージ追加などはユーザーに実行を依頼すること
- **設定ファイル**: 変更前に必ず許可を取得
- **バックアップ不要**: Gitで管理されているため作成不要

## ドキュメント規則

- **記号も全て半角英数** で記述する
- **日時記載禁止**: 更新日時等の記載は不要
- **簡潔性重視**: 工数・後方互換性の考慮は不要
- **コメント規則**:
    - 複雑なロジックのみコメント記載
    - 日本語でのコメント記載
    - TODOコメントは具体的に記載

### Git Commitのルール

- pre-commitを設定していれば検査が通る状態でコミットし、絶対に検査を無視するようなバイパスをしない
- 意味のある最小単位でコミットする
    - メッセージが複数の意味を示す時は分割可能なので、分けること
- コミットメッセージは以下の規則で簡潔な一文を書く
    - 個人リポジトリ (`$HOME/ghq/github.com/peacock0803sz/` 配下) ではEmoji Prefixを採用しているので `$HOME/dotfiles/.config/git/commit-template` を参考にすること
    - 本文は大文字で始め、変更の理由を明確にする
